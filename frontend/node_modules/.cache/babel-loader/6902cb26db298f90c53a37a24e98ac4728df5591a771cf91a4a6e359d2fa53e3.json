{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Navigate}from'react-router-dom';import{jwtDecode}from'jwt-decode';// âœ… Correct import\nimport{jsx as _jsx}from\"react/jsx-runtime\";const ProtectedRoute=_ref=>{let{children,allowedRoles}=_ref;const[valid,setValid]=useState(null);// null = loading\nconst token=localStorage.getItem('token');const role=localStorage.getItem('role');useEffect(()=>{if(!token||!role||!allowedRoles.includes(role)){setValid(false);return;}try{const decoded=jwtDecode(token);if(decoded.exp*1000<Date.now()){localStorage.clear();setValid(false);}else{setValid(true);}}catch(err){console.error('JWT decode error:',err);localStorage.clear();setValid(false);}},[token,role]);if(valid===null){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-20 text-blue-500\",children:\"\\uD83D\\uDD12 Verifying token...\"});}return valid?children:/*#__PURE__*/_jsx(Navigate,{to:\"/login\",replace:true});};export default ProtectedRoute;","map":{"version":3,"names":["React","useEffect","useState","Navigate","jwtDecode","jsx","_jsx","ProtectedRoute","_ref","children","allowedRoles","valid","setValid","token","localStorage","getItem","role","includes","decoded","exp","Date","now","clear","err","console","error","className","to","replace"],"sources":["C:/Users/Shivam/Desktop/Academic-Source/frontend/src/components/ProtectedRoute.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { Navigate } from 'react-router-dom';\r\nimport { jwtDecode } from 'jwt-decode'; // âœ… Correct import\r\n\r\nconst ProtectedRoute = ({ children, allowedRoles }) => {\r\n  const [valid, setValid] = useState(null); // null = loading\r\n  const token = localStorage.getItem('token');\r\n  const role = localStorage.getItem('role');\r\n\r\n  useEffect(() => {\r\n    if (!token || !role || !allowedRoles.includes(role)) {\r\n      setValid(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const decoded = jwtDecode(token);\r\n      if (decoded.exp * 1000 < Date.now()) {\r\n        localStorage.clear();\r\n        setValid(false);\r\n      } else {\r\n        setValid(true);\r\n      }\r\n    } catch (err) {\r\n      console.error('JWT decode error:', err);\r\n      localStorage.clear();\r\n      setValid(false);\r\n    }\r\n  }, [token, role]);\r\n\r\n  if (valid === null) {\r\n    return <div className=\"text-center py-20 text-blue-500\">ðŸ”’ Verifying token...</div>;\r\n  }\r\n\r\n  return valid ? children : <Navigate to=\"/login\" replace />;\r\n};\r\n\r\nexport default ProtectedRoute;\r\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,OAASC,QAAQ,KAAQ,kBAAkB,CAC3C,OAASC,SAAS,KAAQ,YAAY,CAAE;AAAA,OAAAC,GAAA,IAAAC,IAAA,yBAExC,KAAM,CAAAC,cAAc,CAAGC,IAAA,EAAgC,IAA/B,CAAEC,QAAQ,CAAEC,YAAa,CAAC,CAAAF,IAAA,CAChD,KAAM,CAACG,KAAK,CAAEC,QAAQ,CAAC,CAAGV,QAAQ,CAAC,IAAI,CAAC,CAAE;AAC1C,KAAM,CAAAW,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,KAAM,CAAAC,IAAI,CAAGF,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAEzCd,SAAS,CAAC,IAAM,CACd,GAAI,CAACY,KAAK,EAAI,CAACG,IAAI,EAAI,CAACN,YAAY,CAACO,QAAQ,CAACD,IAAI,CAAC,CAAE,CACnDJ,QAAQ,CAAC,KAAK,CAAC,CACf,OACF,CAEA,GAAI,CACF,KAAM,CAAAM,OAAO,CAAGd,SAAS,CAACS,KAAK,CAAC,CAChC,GAAIK,OAAO,CAACC,GAAG,CAAG,IAAI,CAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,CAAE,CACnCP,YAAY,CAACQ,KAAK,CAAC,CAAC,CACpBV,QAAQ,CAAC,KAAK,CAAC,CACjB,CAAC,IAAM,CACLA,QAAQ,CAAC,IAAI,CAAC,CAChB,CACF,CAAE,MAAOW,GAAG,CAAE,CACZC,OAAO,CAACC,KAAK,CAAC,mBAAmB,CAAEF,GAAG,CAAC,CACvCT,YAAY,CAACQ,KAAK,CAAC,CAAC,CACpBV,QAAQ,CAAC,KAAK,CAAC,CACjB,CACF,CAAC,CAAE,CAACC,KAAK,CAAEG,IAAI,CAAC,CAAC,CAEjB,GAAIL,KAAK,GAAK,IAAI,CAAE,CAClB,mBAAOL,IAAA,QAAKoB,SAAS,CAAC,iCAAiC,CAAAjB,QAAA,CAAC,iCAAqB,CAAK,CAAC,CACrF,CAEA,MAAO,CAAAE,KAAK,CAAGF,QAAQ,cAAGH,IAAA,CAACH,QAAQ,EAACwB,EAAE,CAAC,QAAQ,CAACC,OAAO,MAAE,CAAC,CAC5D,CAAC,CAED,cAAe,CAAArB,cAAc","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}